<!DOCTYPE html><!--*-js-indent-level:2;css-indent-offset:2-*-->
<!-- Copyright (c) 2022 by zrajm. License: GPLv2 -->
<meta charset="utf-8">
<link rel=icon href="data:,">
<title>Baremark – Minimal Markdown Parser</title>
<style>
  /* Mini reset. */
  html { box-sizing: border-box; }
  *, :before, :after { box-sizing: inherit; padding: 0; margin: 0; }
  /* Other. */
  body { margin: 1em; line-height: 1.5; }
  blockquote { border: 1px solid #000; }
  code, tt {
    background: #aaac;
    border-radius: .25em;
    padding: .125em .25em .1875em;
    outline: 1px solid #0003;
    background: #0001;
    position: relative;
    bottom: .125em;
  }
  details, .error, .legend {
    border-radius: .25em;
    margin: 2px 0;
    padding: .125em .25em;
    border: 1px solid #0008;
  }
  details.group.ignore, .legend.ignore { background: #777; }
  details.group.pass,   .legend.pass   { background: #4b4; }
  details.test.pass                    { background: #5d5; }
  details.group.fail,   .legend.fail   { background: #d44; }
  details.test.fail,    .error         { background: #e55; }
  details.ignore > summary { text-decoration-line: line-through; }
  .group {
    padding-left: 1em;
  }
  .group > summary {
    font-weight: bold;
    margin-left: -.75em;
  }
  .group div.count { float: right; }
  div.count > span.pass, div.count > span.fail, div.count > span.ignore {
    width: 1.5em;
    display: inline-block;
    text-align: right;
    color: #444;
  }
  div.count > span.pass { color: #050; }
  div.count > span.fail { color: #600; }
  textarea { width: 100%; overflow: visible; height: fit-content; background: #0000;}
  summary { cursor: pointer; }
  hr { margin: 2em; }
  table {
    border-spacing: .125em;
  }
  td, th {
    vertical-align: baseline;
    font-family: sans;
  }
  th {
    color: #000d;
  }
  tbody th { text-align: right; }
  td {
    border-radius: .25em;
    background: #0002;
    font-weight: normal;
    text-align: left;
    padding: .125em .25em .1875em;
  }
  li { margin-left: 1em; }
  p, h1, h2, footer { margin: 1em 0 .5em; }
  footer { text-align: center; }
  .fixme { background: #ff0b; font-weight: bold; }
</style>
<body>
</body>
<script src="jquery-3.6.0.slim.min.js"></script>
<script src="landmark.js"></script>
<script src="baremark.js"></script>

<h1>Baremark – Minimal Markdown Parser</h1>

<p><a href="baremark.js" target=_blank>Baremark</a> is a minimal Markdown
parser based on Van Tigranyan’s
Gist <a href="https://gist.github.com/VanTigranyan/651b7c77cfc149cb858a044c2108acbb"
target=_blank>Landmark</a>, but with some bugfixes, optimizations, and (a
little more) standards compliance. Here’s my <a href="TODO.txt"
target=_blank>TODO list</a> for Baremark (in Emacs org-mode format).</p>


<h2>Baremark Test Cases</h2>

<p>These test cases are meant work as the specs for Baremark, though they will
likely evolve as Baremark does so. I strive to make Baremark more CommonMark
compliant, but full compliance will never be achieved as the intent of Baremark
is to err on the side of brevity.</p>

<p>Baremark does not have indented code blocks (use <i>fenced</i> code blocks
instead). Also indenting header or fenced code markup etc. is not supported.
Where the CommonMark standard allow whitespace at the end of lines (e.g. after
final ‘#’ and ‘```’) Baremark interpret these literally. These things might
change in the future.</p>

<p><b>Legend:</b>
  <span class="legend pass">Passed</span>
  <span class="legend fail">Failed</span>
  <span class="legend ignore"><s>All ignored</s></span></p>

<div data-testsuite="tests-baremark.json"></div>


<h2>Baremark Test Cases Run against Landmark</h2>

<p>These are the same test cases as above, but run against the original
Landmark module.</p>

<p><b>Legend:</b>
  <span class="legend pass">Passed</span>
  <span class="legend fail">Failed</span>
  <span class="legend ignore"><s>All ignored</s></span></p>

<div data-testsuite="tests-baremark.json" data-module="Landmark"></div>


<h2>CommmonMark 0.30 Test Cases</h2>

<p>These are the <a href="https://spec.commonmark.org/0.30/spec.json"
target=_blank>test cases</a> of the <a href="https://spec.commonmark.org/0.30/"
target=_blank>CommonMark 0.30 spec</a> run against Baremark. As Baremark is
intended to be minimal in size, not all of these CommonMark tests will ever
pass, but they can give you an idea of how compatible Baremark is.</p>

<p><b>Legend:</b>
  <span class="legend pass">Passed</span>
  <span class="legend fail">Failed</span>
  <span class="legend ignore"><s>All ignored</s></span></p>

<div data-testsuite="tests-commonmark.json"></div>


<h2>Test Framework</h2>

<p>I kinda, sorta, accidentally put this very simple test framework/page
together to present how well Baremark fared with the CommonMark test suite. The
below “test results” are only meant to show what different kind of test results
look like on the page.</p>

<p><b>Legend:</b>
  <span class="legend pass">Passed</span>
  <span class="legend fail">Failed</span>
  <span class="legend ignore"><s>All ignored</s></span></p>

<div data-testsuite="tests-framework.json"></div>

<script>
  $(()=>{
    // jQuery plugins.
    jQuery.fn.forEach = [].forEach
    jQuery.fn.reduce = [].reduce

    function escapeHtml(x) {
      return x.replace(
        /["&<>]/g,
        x => `&${{ '"': 'quot', '&': 'amp', '<': 'lt', '>': 'gt' }[x]};`)
    }
    // Escape any ASCII control characters with C escape sequences.
    function escapeAscii(x) {
      return x.replace(
        /[\x00-\x1f\x7f-\x9f\\]/g,
        m => ({
          '\a': '\\a', '\b': '\\b', '\f': '\\f',  '\n'  : '\\n', '\r': '\\r',
          '\t': '\\t', '\v': '\\v', '\\': '\\\\', '\x1B': '\\e', ' ' : '␣',
        }[m] ||
          '\\x' + m.charCodeAt(0).toString(16).toUpperCase().padStart(2, '0')))
    }
    function warn(html) {
      if (/<style\b/.test(html)) {
        return '!!! Contains <tt>&lt;style&gt;</tt> tag, won’t display here!'
      } else if (/<script\b/.test(html)) {
        return '!!! Contains <tt>&lt;script&gt;</tt> tag, won’t display here!'
      } else if (/<img\b/.test(html)) {
        return '!!! Contains <tt>&lt;img&gt;</tt> tag, won’t display here!'
      }
      return ''
    }
    function processTests(tests, $e, cb) {
      if (!tests.length) {
        $e.html('[NONE YET]')
        return
      }
      let sectionName, $section
      tests.forEach((test) => {
        // If section name as changed, append new section.
        if (sectionName !== test.section) {
          sectionName = test.section
          $section = $(`<details class=group>
              <summary>${test.section}</summary>
             </details>`).appendTo($e)
        }
        // Count as pass, fail or ignore.
        const expect = test.bare || test.html
        const got = cb(test.markdown)

        // Add test result to current section.
        $section.append(
          `<details class="test ${test.ignore ? 'ignore' : ''} ${got === expect ? 'pass' : 'fail'}">
            <summary>
              ${test.example ? `Test ${test.example}` : ''}
              ${test.example && test.title ? ': ' : ''}
              ${test.title ? escapeAscii(test.title) : ''}
              ${test.FIXME ? ` (<span class=fixme>FIXME: ${escapeAscii(test.FIXME)}</span>)` : ''}
            </summary>
            <table>
              <thead><tr><th><th>Code<th>Appearance</thead>
              <tr><th>Markdown
                <td><pre>${escapeAscii(escapeHtml(test.markdown))}</pre>
                <td><pre>${warn(test.markdown) || escapeHtml(test.markdown)}</pre>
              <tr><th>Expected
                <td><pre>${escapeAscii(escapeHtml(expect))}</pre>
                <td>${warn(expect) || expect}
              <tr><th>Got
                <td><pre>${escapeAscii(escapeHtml(got))}</pre>
                <td>${warn(got) || got}
            </table>
          </details>`)
      })

      // Go through sections, set color and append counters.
      $e.find('> details.group').forEach(e => {
        const $e = $(e)
        const counter = $e.find('> details.test').reduce((a, e) => {
          const $e = $(e)
          a[$e.hasClass('ignore') ? 'ignore' : $e.hasClass('pass') ? 'pass' : 'fail'] += 1
          return a
        }, { pass: 0, fail: 0, ignore: 0 })
        $e.addClass(`
          ${counter.fail   ? 'fail'   : ''}
          ${counter.pass   ? 'pass'   : ''}
          ${counter.ignore ? 'ignore' : ''}`)
          .find('> summary').append(
            `<div class=count>
              <span class=fail>${counter.fail}</span>
              <span class=pass>${counter.pass}</span>
              <span class=ignore>${counter.ignore}</span>
            </div>`)
      })
    }
    // Load test cases from jsonUrl and show in $e (jQuery DOM element).
    function testSuite(jsonUrl, $e, cb) {
      window.fetch(jsonUrl)
        .then(response => response.text())
        .then(json => {
          try {
            return processTests(JSON.parse(json), $e, cb)
          } catch (e) {
            $e.append(`<div class=error><b>Failed to load JSON file ‘${jsonUrl}’</b><br>${e}`)
          }
        })
    }
    $('[data-testsuite]')
      .forEach(e => testSuite(
        e.dataset.testsuite,
        $(e),
        self[e.dataset.module || 'Baremark'].render
      ))
  })
</script>
<script>
  (() => {
    let c = 0
    const x = [{
      src: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" height="24" width="22">'
        + '<path d="M0 22h22v2H0zM0 0v20h22V0H0Zm10 4h2v10.6l2.3-2.3.7-.7 1.4 1.4-.7.7-4 4-.7.7-.7-.7-4-4-.7-.7L7 11.6l.7.7 2.3 2.3V4Z"/></svg>',
      title: 'Show all test results'
    }, {
      src: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" height="24" width="22">'
        + '<path d="M0 2h22V0H0Zm0 22V4h22v20H0Zm10-4h2V9.4l2.3 2.3.7.7 1.4-1.4-.7-.7-4-4-.7-.7-.7.7-4 4-.7.7L7 12.4l.7-.7L10 9.4V20z"/></svg>',
      title: 'Hide all test results'
    }]
    const $t = $('<img>')
      .prependTo('body')
      .css({ opacity: .3, position: 'fixed', top: '.5rem', right: '.5rem', cursor: 'pointer' })
      .attr(x[c])
      .on('click', () => {
        $('details').attr('open', !c)
        c = !c + 0
        $t.attr(x[c])
      })
  })()
</script>


<footer>© 2022 by zrajm, Uppsala.</footer>
<!--[eof]-->

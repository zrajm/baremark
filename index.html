<!DOCTYPE html><!--*-js-indent-level:2;css-indent-offset:2-*-->
<!-- Copyright (c) 2022-2024 by zrajm. License: GPLv2 -->
<meta charset="utf-8">
<link rel=icon href=baremark.svg>
<title>Baremark: A Tiny Markdown Engine</title>
<link rel=stylesheet href=index.css>


<h1 id=top>Baremark: A Tiny Markdown Engine</h1>

<details>
  <summary>README</summary>
  <div id=readme>Loading… (Requires Javascript)</div>
</details>
<script src=baremark.js></script>
<script>
  fetch('README.md')
    .then(x => x.text())
    .then(md => document.getElementById('readme').innerHTML = baremark(md))
</script>


<h2 id=baremark>Test Cases</h2>

<p>The test cases below are intended as specs for Baremark, though they will
evolve as Baremark does so.

<p><b>Legend:</b>
  <span class="legend pass">Passed</span>
  <span class="legend fail">Failed</span>
  <span class="legend ignore"><s>All ignored</s></span></p>

<div data-testsuite="tests-baremark.json" data-function="baremark"></div>


<h2 id=commonmark>CommmonMark 0.30 Test Cases</h2>

<p>These are the <a href="https://spec.commonmark.org/0.30/spec.json"
target=_blank>test cases</a> of the <a href="https://spec.commonmark.org/0.30/"
target=_blank>CommonMark 0.30 spec</a> run against Baremark. As Baremark is
intended to be minimal in size, not all of these CommonMark tests will ever
pass, but they can give you an idea of how compatible Baremark is.</p>

<p>The HTML generated by Baremark is not necessarily identical to that of other
CommonMark compliant Markdown generators. Among other things, Baremark favor
older HTML tags, such as <tt>&lt;i></tt>, <tt>&lt;b></tt> and <tt>&lt;s></tt>
(over the newer <tt>&lt;em></tt>, <tt>&lt;strong></tt> and <tt>&lt;del></tt>
etc) simply because they’re shorter. (<i>Semantic markup, pha!</i>—Who are we
kidding anyway?!) Neither does Baremark spend any effort on collapsing or
cleaning up your whitespace for you (your browser will collapse for you
anyway), so for the most part, the whitespace found in the outputted HTML is
the same as the one found in the Markdown (with the obvious exceptions being
the processing of newlines and linebreaks mandated by the Markdown specs). For
source brevity Baremark uses HTML character code entities (such
as <tt>&amp;#38;</tt>), rather than more commonly seen named entities
(<tt>&amp;amp;</tt>).</p>

<p><b>Legend:</b>
  <span class="legend pass">Passed</span>
  <span class="legend fail">Failed</span>
  <span class="legend ignore"><s>All ignored</s></span></p>

<div data-testsuite="tests-commonmark.json" data-function="baremark"></div>


<h2 id=framework>Test Framework</h2>

<p>I kinda, sorta, accidentally put this very simple test framework/page
together to present how well Baremark fared with the CommonMark test suite. The
below “test results” are only meant to show what different kind of test results
look like on the page.</p>

<p><b>Legend:</b>
  <span class="legend pass">Passed</span>
  <span class="legend fail">Failed</span>
  <span class="legend ignore"><s>All ignored</s></span></p>

<div data-testsuite="tests-framework.json" data-function="baremark"></div>

<footer>© 2022 by zrajm, Uppsala.</footer>
<script src="jquery-3.6.0.slim.min.js"></script>
<script src="baremark.js"></script>
<script>
  $(()=>{
    // jQuery plugins.
    jQuery.fn.forEach = [].forEach
    jQuery.fn.reduce = [].reduce

    function escapeHtml(x) {
      return x.replace(
        /["&<>]/g,
        x => `&${{ '"': 'quot', '&': 'amp', '<': 'lt', '>': 'gt' }[x]};`)
    }
    // Escape any ASCII control characters with C escape sequences.
    function escapeAscii(x) {
      return x.replace(
        /[\x00-\x1f\x7f-\x9f\\]/g,
        m => ({
          '\a': '\\a', '\b': '\\b', '\f': '\\f',  '\n'  : '\\n', '\r': '\\r',
          '\t': '\\t', '\v': '\\v', '\\': '\\\\', '\x1B': '\\e', ' ' : '␣',
        }[m] ||
          '\\x' + m.charCodeAt(0).toString(16).toUpperCase().padStart(2, '0')))
    }
    function warn(html) {
      if (/<style\b/.test(html)) {
        return '!!! Contains <tt>&lt;style&gt;</tt> tag, won’t display here!'
      } else if (/<script\b/.test(html)) {
        return '!!! Contains <tt>&lt;script&gt;</tt> tag, won’t display here!'
      } else if (/<img\b/.test(html)) {
        return '!!! Contains <tt>&lt;img&gt;</tt> tag, won’t display here!'
      }
      return ''
    }
    function processTests(tests, $e, cb) {
      if (!tests.length) {
        $e.html('[NONE YET]')
        return
      }
      let sectionName, $section
      tests.forEach((test) => {
        // If test is just a string (not object) turn it into section heading.
        if (typeof test === 'string') {
          test = { section: test }
        }
        // If section name as changed, append new section.
        if (test.section !== undefined && sectionName !== test.section) {
          sectionName = test.section
          $section = $(`<details class=group>
              <summary>${test.section}</summary>
             </details>`).appendTo($e)
        }
        if (test.markdown === undefined) { return }
        // Count as pass, fail or ignore.
        const expect = test.bare || test.html
        const got = (() => {
          try {
            return cb(test.markdown)
          } catch (e) {
            return `CAUGHT ERROR: ${e}`
          }
        })()

        // Add test result to current section.
        $section.append(
          `<details class="test ${test.ignore ? 'ignore' : ''} ${got === expect ? 'pass' : 'fail'}">
            <summary>
              ${test.example ? `Test ${test.example}` : ''}${test.example && test.title ? ': ' : ''}
              ${test.title ? escapeAscii(test.title) : ''}
              ${test.FIXME ? ` <span class=fixme>(FIXME: ${escapeAscii(test.FIXME)})</span>` : ''}
              ${test.NOTE ? ` <span class=note>(NOTE: ${escapeAscii(test.NOTE)})</span>` : ''}
            </summary>
            <table>
              <thead><tr><th><th>Code<th>Appearance</thead>
              <tr><th>Markdown
                <td><pre>${escapeAscii(escapeHtml(test.markdown))}</pre>
                <td><pre>${warn(test.markdown) || escapeHtml(test.markdown)}</pre>
              <tr><th>Expected
                <td><pre>${escapeAscii(escapeHtml(expect))}</pre>
                <td>${warn(expect) || expect}
              <tr><th>Got
                <td><pre>${escapeAscii(escapeHtml(got))}</pre>
                <td>${warn(got) || got}
            </table>
          </details>`)
      })

      // Go through sections, set color and append counters.
      $e.find('> details.group').forEach(e => {
        const $e = $(e)
        const counter = $e.find('> details.test').reduce((a, e) => {
          const $e = $(e)
          a[$e.hasClass('ignore') ? 'ignore' : $e.hasClass('pass') ? 'pass' : 'fail'] += 1
          return a
        }, { pass: 0, fail: 0, ignore: 0 })
        $e.addClass(`
          ${counter.fail   ? 'fail'   : ''}
          ${counter.pass   ? 'pass'   : ''}
          ${counter.ignore ? 'ignore' : ''}`)
          .find('> summary').append(
            `<div class=count>
              <span class=fail>${counter.fail}</span>
              <span class=pass>${counter.pass}</span>
              <span class=ignore>${counter.ignore}</span>
            </div>`)
      })
    }
    // Load test cases from jsonUrl and show in $e (jQuery DOM element).
    function testSuite(jsonUrl, $e, cb) {
      window.fetch(jsonUrl)
        .then(response => response.text())
        .then(json => {
          try {
            return processTests(JSON.parse(json), $e, cb)
          } catch (e) {
            $e.append(`<div class=error><b>Failed to load JSON file ‘${jsonUrl}’</b><br>${e}`)
          }
        })
    }
    $('[data-testsuite]')
      .forEach(e => testSuite(
        e.dataset.testsuite,
        $(e),
        self[e.dataset.function]
      ))
  })
</script>
<script>
  (() => {
    let c = 0
    const x = [{
      src: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" height="24" width="22">'
        + '<path d="M0 22h22v2H0zM0 0v20h22V0H0Zm10 4h2v10.6l2.3-2.3.7-.7 1.4 1.4-.7.7-4 4-.7.7-.7-.7-4-4-.7-.7L7 11.6l.7.7 2.3 2.3V4Z"/></svg>',
      title: 'Show all test results'
    }, {
      src: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" height="24" width="22">'
        + '<path d="M0 2h22V0H0Zm0 22V4h22v20H0Zm10-4h2V9.4l2.3 2.3.7.7 1.4-1.4-.7-.7-4-4-.7-.7-.7.7-4 4-.7.7L7 12.4l.7-.7L10 9.4V20z"/></svg>',
      title: 'Hide all test results'
    }]
    const $t = $('<img>')
      .prependTo('body')
      .css({ opacity: .3, position: 'fixed', top: '.5rem', right: '.5rem', cursor: 'pointer' })
      .attr(x[c])
      .on('click', () => {
        $('details').attr('open', !c)
        c = !c + 0
        $t.attr(x[c])
      })
  })()
</script>
<!--[eof]-->
